{"version":3,"sources":["../../src/utils/get-image.js"],"names":["getImage","path","require","fs","cacheImageResults","Map","REMOTE_URL","url","source","fileExistsCheck","testPath","has","preservePromiseMethods","get","match","join","dirname","localFileExists","remoteFileExists","then","response","set","catch","error","result","Error","Promise","reject","resolve","fileURL","responseType","filePath","stat","status"],"mappings":";;;;;kBAWwBA,Q;;AAXxB;;;;;;AAEA,IAAMC,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,KAAKD,QAAQ,IAAR,CAAX;;AAEA,IAAME,oBAAoB,IAAIC,GAAJ,EAA1B;;AAEA;AACA;AACA,IAAMC,aAAa,oBAAnB;;AAEe,SAASN,QAAT,CAAkBO,GAAlB,EAAuBC,MAAvB,EAA+B;AAC5C,MAAIC,kBAAkB,IAAtB;AACA,MAAIC,WAAW,IAAf;;AAEA,MAAIN,kBAAkBO,GAAlB,CAAsBJ,GAAtB,CAAJ,EAAgC;AAC9B,WAAOK,uBAAuBR,kBAAkBS,GAAlB,CAAsBN,GAAtB,CAAvB,CAAP;AACD;;AAED,MAAI,CAACA,IAAIO,KAAJ,CAAUR,UAAV,CAAL,EAA4B;AAC1BI,eAAWT,KAAKc,IAAL,CAAUd,KAAKe,OAAL,CAAaR,MAAb,CAAV,EAAgCD,GAAhC,CAAX;AACAE,sBAAkBQ,eAAlB;AACD,GAHD,MAGO;AACLP,eAAWH,GAAX;AACAE,sBAAkBS,gBAAlB;AACD;;AAED,SAAOT,gBAAgBC,QAAhB,EACJS,IADI,CACC,UAACC,QAAD,EAAc;AAClBhB,sBAAkBiB,GAAlB,CAAsBd,GAAtB,EAA2Ba,QAA3B;AACA,WAAOA,QAAP;AACD,GAJI,EAKJE,KALI,CAKE,UAACC,KAAD,EAAW;AAChBnB,sBAAkBiB,GAAlB,CAAsBd,GAAtB,EAA2BgB,KAA3B;AACA,WAAOA,KAAP;AACD,GARI,EASJJ,IATI,CASCP,sBATD,CAAP;AAUD;;AAED,SAASA,sBAAT,CAAgCY,MAAhC,EAAwC;AACtC,MAAIA,kBAAkBC,KAAtB,EAA6B;AAC3B,WAAOC,QAAQC,MAAR,CAAeH,MAAf,CAAP;AACD;;AAED,SAAOE,QAAQE,OAAR,CAAgBJ,MAAhB,CAAP;AACD;;AAED,SAASN,gBAAT,CAA0BW,OAA1B,EAAmC;AACjC,SAAO,gBAAMhB,GAAN,CAAUgB,OAAV,EAAmB,EAAEC,cAAc,aAAhB,EAAnB,CAAP;AACD;;AAED,SAASb,eAAT,CAAyBc,QAAzB,EAAmC;AACjC,SAAO,IAAIL,OAAJ,CAAY,UAACE,OAAD,EAAUD,MAAV,EAAqB;AACtCxB,OAAG6B,IAAH,CAAQD,QAAR,EAAkB,UAACR,KAAD,EAAQS,IAAR,EAAiB;AACjC,UAAIT,KAAJ,EAAW;AACTA,cAAMH,QAAN,GAAiB,EAAEa,QAAQ,GAAV,EAAjB;AACAN,eAAOJ,KAAP;AACD,OAHD,MAGO;AACLK,gBAAQI,IAAR;AACD;AACF,KAPD;AAQD,GATM,CAAP;AAUD","file":"get-image.js","sourcesContent":["import axios from 'axios';\n\nconst path = require('path');\nconst fs = require('fs');\n\nconst cacheImageResults = new Map();\n\n// Remote URLs\n// From: http://stackoverflow.com/a/19709846/4709891\nconst REMOTE_URL = /^(?:[a-z]+:)?\\/\\//i;\n\nexport default function getImage(url, source) {\n  let fileExistsCheck = null;\n  let testPath = null;\n\n  if (cacheImageResults.has(url)) {\n    return preservePromiseMethods(cacheImageResults.get(url));\n  }\n\n  if (!url.match(REMOTE_URL)) {\n    testPath = path.join(path.dirname(source), url);\n    fileExistsCheck = localFileExists;\n  } else {\n    testPath = url;\n    fileExistsCheck = remoteFileExists;\n  }\n\n  return fileExistsCheck(testPath)\n    .then((response) => {\n      cacheImageResults.set(url, response);\n      return response;\n    })\n    .catch((error) => {\n      cacheImageResults.set(url, error);\n      return error;\n    })\n    .then(preservePromiseMethods);\n}\n\nfunction preservePromiseMethods(result) {\n  if (result instanceof Error) {\n    return Promise.reject(result);\n  }\n\n  return Promise.resolve(result);\n}\n\nfunction remoteFileExists(fileURL) {\n  return axios.get(fileURL, { responseType: 'arraybuffer' });\n}\n\nfunction localFileExists(filePath) {\n  return new Promise((resolve, reject) => {\n    fs.stat(filePath, (error, stat) => {\n      if (error) {\n        error.response = { status: 404 };\n        reject(error);\n      } else {\n        resolve(stat);\n      }\n    });\n  });\n}\n"]}